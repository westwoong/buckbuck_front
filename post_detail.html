<!DOCTYPE html>
<html lang="en">
<div class="header">
    <div class="title"><a href="index.html">BuckBuck</a></div>
    <div class="buttons">
        <button id="loginButton">로그인</button>
        <button id="signupButton">회원가입</button>
        <button id="logoutButton" style="display: none;">로그아웃</button>
    </div>
    <link rel="stylesheet" href="/css/forum.css">
</div>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BuckBuck</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        /* Add subtle border between title and content */
        .title-content-divider,
        .section-divider {
            border-top: 1px solid rgba(0, 0, 0, 0.1); /* Subtle gray border */
            margin-top: 1.5rem; /* Adjust margin for spacing */
        }

        /* Optional: Add a shadow effect for better visual separation */
        .title-content-divider,
        .section-divider {
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Shadow effect */
            margin-top: 2rem; /* Adjust margin for spacing */
        }

        /* Adjust width of content area */
        #content {
            max-width: 100%; /* Adjust as needed */
        }
    </style>
</head>

<body class="bg-gray-100 dark:bg-gray-800">
<div class="px-4 py-6 md:px-6 lg:py-12">
    <div class="space-y-4">
        <div class="space-y-2">
            <h1 id="title" class="text-3xl font-bold tracking-tight"></h1>
            <p id="postDate" class="text-gray-500 dark:text-gray-400"></p>
        </div>
        <div class="title-content-divider"></div><!-- Add divider between title and content -->
        <div id="content" class="prose prose-gray max-w-none not-italic"></div>
        <div class="section-divider"></div><!-- Add divider between title and details -->
        <div class="bg-white rounded-lg p-4">
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <h3 class="text-base font-semibold">의뢰금액</h3>
                    <p id="cost" class="text-sm text-gray-500 dark:text-gray-400"></p>
                </div>
                <div>
                    <h3 class="text-base font-semibold">의뢰 난이도</h3>
                    <p id="level" class="text-sm text-gray-500 dark:text-gray-400"></p>
                </div>
                <div class="col-span-2">
                    <h3 class="text-base font-semibold">작성일</h3>
                    <p id="createdAt" class="text-sm text-gray-500 dark:text-gray-400"></p>
                </div>
            </div>
        </div>
        <h2 class="text-2xl font-bold tracking-tight">댓글 목록</h2>
        <div id="comments" class="space-y-4">
            <!-- Comments will be dynamically added here -->
        </div>
    </div>
</div>

<script>
    window.onload = function () {
        const urlParams = new URLSearchParams(window.location.search);
        const postId = urlParams.get('id');

        fetch(`http://localhost:3000/posts/${postId}`)
            .then(response => response.json())
            .then(data => {
                const postData = data.post;

                // Fill in post details
                document.getElementById('title').innerText = postData.title;

                const createdAt = new Date(postData.createdAt);

                document.getElementById('content').innerHTML = '<p>' + postData.content + '</p>';
                document.getElementById('cost').innerText = postData.cost;
                document.getElementById('level').innerText = postData.level;
                document.getElementById('createdAt').innerText = formatDate(createdAt);

                // Fill in comments
                const commentsContainer = document.getElementById('comments');
                postData.comments.forEach(comment => {
                    const commentDiv = document.createElement('div');
                    commentDiv.classList.add('bg-white', 'rounded-lg', 'p-4', 'flex', 'flex-col', 'space-y-2');

                    const commentContent = document.createElement('div');
                    const username = document.createElement('h3');
                    username.classList.add('text-lg', 'font-semibold');
                    username.innerText = comment.nickName;
                    const userComment = document.createElement('p');
                    userComment.classList.add('text-sm', 'text-gray-500', 'dark:text-gray-400');
                    userComment.innerText = comment.content;

                    const proposalCost = document.createElement('span');
                    proposalCost.classList.add('text-sm', 'font-semibold', 'text-gray-500');
                    proposalCost.innerText = ' | 제안 금액: ' + comment.proposalCost;

                    const createdAt = new Date(comment.createdAt);
                    const createdDate = formatDate(createdAt);
                    const createdTime = formatTime(createdAt);
                    const commentTime = document.createElement('span');
                    commentTime.classList.add('text-sm', 'text-gray-500', 'dark:text-gray-400');
                    commentTime.innerText = createdDate + ' ' + createdTime;

                    commentContent.appendChild(username);
                    commentContent.appendChild(userComment);
                    commentContent.appendChild(proposalCost);

                    commentDiv.appendChild(commentContent);
                    commentDiv.appendChild(commentTime);

                    commentsContainer.appendChild(commentDiv);
                });
            })
            .catch(error => alert('게시글을 불러오지 못했습니다.'));
    }

    function formatDate(date) {
        return `${date.getFullYear()}.${(date.getMonth() + 1).toString().padStart(2, '0')}.${date.getDate().toString().padStart(2, '0')}`;
    }

    function formatTime(date) {
        return `${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
    }

    document.addEventListener('DOMContentLoaded', function () {
        const token = localStorage.getItem('token');

        if (token) {
            // 토큰이 있으면 로그아웃 표시
            document.getElementById('logoutButton').style.display = 'block';
            document.getElementById('loginButton').style.display = 'none';
        } else {
            // 토큰이 없으면 로그인 표시
            document.getElementById('logoutButton').style.display = 'none';
            document.getElementById('loginButton').style.display = 'block';
        }
    });

    // 로그아웃
    document.getElementById('logoutButton').addEventListener('click', function () {
        localStorage.removeItem('token');
        alert('로그아웃 되었습니다')
        location.reload();
    });

    document.getElementById('loginButton').addEventListener('click', function () {
        window.location.href = 'login.html';
    });

    document.getElementById('signupButton').addEventListener('click', function () {
        window.location.href = 'signup.html';
    });
</script>
</body>
</html>
