<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BuckBuck</title>
    <link rel="stylesheet" href="/css/layout.css">
    <link rel="stylesheet" href="/css/buttons.css">
    <link rel="stylesheet" href="/css/forum.css">
    <link rel="stylesheet" href="/css/posts.css">
</head>
<body>
<div class="header">
    <div class="title"><a href="index.html">BuckBuck</a></div>
    <div class="buttons">
        <button id="loginButton">로그인</button>
        <button id="signupButton">회원가입</button>
        <button id="logoutButton" style="display: none;">로그아웃</button>
    </div>
</div>
<div class="forum">
    <div class="forum-header">
        <div class="id">id</div>
        <div class="title">제목</div>
        <div class="writer">글쓴이</div>
        <div class="date">작성일</div>
    </div>
    <div id="postList" class="forum-post">
        <script>
            fetch('http://localhost:3000/posts?page=1')
                .then(response => response.json())
                .then(data => {
                    const postList = document.getElementById('postList');
                    data.posts.forEach(post => {
                        const postItem = document.createElement('div');
                        postItem.classList.add('forum-post');
                        const createdAt = new Date(post.createdAt);
                        const createdDate = `${createdAt.getFullYear()}.${(createdAt.getMonth() + 1).toString().padStart(2, '0')}.${createdAt.getDate().toString().padStart(2, '0')}`;
                        const createdTime = `${createdAt.getHours().toString().padStart(2, '0')}:${createdAt.getMinutes().toString().padStart(2, '0')}`;
                        postItem.innerHTML = `
                            <div class="id">${post.id}</div>
                            <div class="title"><a href="post_detail.html?id=${post.id}">${post.title}</a></div>
                            <div class="writer">${post.nickName}</div>
                            <div class="date">${createdDate}  ${createdTime}</div>
                        `;
                        postList.appendChild(postItem);
                    });
                })
                .catch(error => alert('게시글을 불러오지 못했습니다.'));
        </script>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const token = localStorage.getItem('token');

        if (token) {
            // 토큰이 있으면 로그아웃 표시
            document.getElementById('logoutButton').style.display = 'block';
            document.getElementById('loginButton').style.display = 'none';
        } else {
            // 토큰이 없으면 로그인 표시
            document.getElementById('logoutButton').style.display = 'none';
            document.getElementById('loginButton').style.display = 'block';
        }
    });

    // 로그아웃
    document.getElementById('logoutButton').addEventListener('click', function () {
        localStorage.removeItem('token');
        alert('로그아웃 되었습니다')
        location.reload();
    });

    document.getElementById('loginButton').addEventListener('click', function () {
        window.location.href = 'login.html';
    });

    document.getElementById('signupButton').addEventListener('click', function () {
        window.location.href = 'signup.html';
    });
</script>

</body>
</html>
